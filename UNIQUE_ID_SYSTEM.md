# Unique ID Generation System

## Overview
This system generates two types of unique IDs for job management:
1. **Company ID**: One unique ID per company (reused for all jobs from that company)
2. **Job ID**: Unique ID for each job created by any company

## Library Used: `nanoid`

### Why nanoid?
- ✅ **Secure**: Cryptographically strong random number generator
- ✅ **Fast**: 2x faster than UUID
- ✅ **Small**: Only 130 bytes (minified and gzipped)
- ✅ **URL-friendly**: Uses safe characters (no special symbols)
- ✅ **Collision-resistant**: 1% probability of collision after generating 1 billion IDs
- ✅ **Customizable**: Can define custom alphabet and length

### Installation
```bash
npm install nanoid
```

## ID Format

### Company ID Format
```
COMP-YYYYMMDD-XXXXXXXXXX
```

**Example**: `COMP-20250109-A1B2C3D4E5`

**Components**:
- `COMP`: Prefix identifying this as a company ID
- `YYYYMMDD`: Date when company was created (20250109 = January 9, 2025)
- `XXXXXXXXXX`: 10-character unique code generated by nanoid (uppercase alphanumeric)

### Job ID Format
```
JOB-YYYYMMDD-XXXXXXXXXX
```

**Example**: `JOB-20250109-K9L8M7N6O5`

**Components**:
- `JOB`: Prefix identifying this as a job ID
- `YYYYMMDD`: Date from the company's creation (maintains relationship)
- `XXXXXXXXXX`: 10-character unique code generated by nanoid (uppercase alphanumeric)

## How It Works

### 1. Company Creation Flow
```javascript
// User creates first job for "Tech Corp"
POST /api/jobs
{
  "companyName": "Tech Corp",
  "title": "Software Engineer",
  ...
}

// System checks if "Tech Corp" exists
// If NOT found:
//   1. Generate unique Company ID: COMP-20250109-A1B2C3D4E5
//   2. Save to 'companies' collection
//   3. Use this Company ID for the job

// If FOUND:
//   1. Reuse existing Company ID
//   2. Use it for the new job
```

### 2. Job Creation Flow
```javascript
// For each job:
//   1. Get or create company (gets Company ID)
//   2. Generate unique Job ID: JOB-20250109-K9L8M7N6O5
//   3. Link Job ID to Company ID
//   4. Save to 'jobs' collection
```

### 3. Example Scenario
```
Company: "Tech Corp"
├── Company ID: COMP-20250109-A1B2C3D4E5
├── Job 1: Software Engineer
│   └── Job ID: JOB-20250109-K9L8M7N6O5
├── Job 2: Product Manager
│   └── Job ID: JOB-20250109-P3Q4R5S6T7
└── Job 3: Data Scientist
    └── Job ID: JOB-20250109-U8V9W0X1Y2

Company: "StartupXYZ"
├── Company ID: COMP-20250109-Z9Y8X7W6V5
├── Job 1: Frontend Developer
│   └── Job ID: JOB-20250109-M5N6O7P8Q9
└── Job 2: Backend Developer
    └── Job ID: JOB-20250109-R1S2T3U4V5
```

## Database Schema

### Companies Collection
```javascript
{
  _id: ObjectId("..."),
  companyId: "COMP-20250109-A1B2C3D4E5",  // Unique
  companyName: "Tech Corp",
  createdAt: ISODate("2025-01-09T10:30:00Z"),
  updatedAt: ISODate("2025-01-09T10:30:00Z")
}
```

### Jobs Collection
```javascript
{
  _id: ObjectId("..."),
  jobId: "JOB-20250109-K9L8M7N6O5",        // Unique
  companyId: "COMP-20250109-A1B2C3D4E5",   // Links to company
  title: "Software Engineer",
  description: "...",
  jobRole: "Software Engineer",
  companyName: "Tech Corp",
  slug: "software-engineer",
  fields: [...],
  status: "draft",
  version: 1,
  createdAt: ISODate("2025-01-09T10:30:00Z"),
  updatedAt: ISODate("2025-01-09T10:30:00Z")
}
```

## API Endpoints

### Create Job (Auto-generates IDs)
```bash
POST /api/jobs
Content-Type: application/json

{
  "title": "Software Engineer",
  "description": "We are looking for...",
  "jobRole": "Software Engineer",
  "companyName": "Tech Corp",
  "fields": [...]
}

# Response
{
  "success": true,
  "data": {
    "id": "65a1b2c3d4e5f6g7h8i9j0",
    "jobId": "JOB-20250109-K9L8M7N6O5",
    "companyId": "COMP-20250109-A1B2C3D4E5",
    "title": "Software Engineer",
    "companyName": "Tech Corp",
    ...
  },
  "message": "Job created successfully"
}
```

### Get All Jobs
```bash
GET /api/jobs

# Response
{
  "success": true,
  "data": [
    {
      "jobId": "JOB-20250109-K9L8M7N6O5",
      "companyId": "COMP-20250109-A1B2C3D4E5",
      "title": "Software Engineer",
      ...
    }
  ],
  "pagination": {...},
  "stats": {
    "totalJobs": 5,
    "totalCompanies": 2
  }
}
```

### Get Jobs by Company
```bash
GET /api/jobs?company_id=COMP-20250109-A1B2C3D4E5

# Returns all jobs for that specific company
```

### Get All Companies
```bash
GET /api/companies

# Response
{
  "success": true,
  "data": [
    {
      "companyId": "COMP-20250109-A1B2C3D4E5",
      "companyName": "Tech Corp",
      "jobCount": 3,
      "createdAt": "2025-01-09T10:30:00Z"
    }
  ]
}
```

## Code Implementation

### Custom Alphabet Configuration
```javascript
import { customAlphabet } from 'nanoid'

// Generate uppercase alphanumeric IDs (0-9, A-Z)
const generateId = customAlphabet('0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ', 10)

// Usage
const uniqueCode = generateId()  // Returns: "A1B2C3D4E5"
```

### Company ID Generation
```javascript
async function generateCompanyId(companyName) {
  const date = new Date()
  const dateStr = date.toISOString().slice(0, 10).replace(/-/g, '')
  const uniqueCode = generateId()
  const companyId = `COMP-${dateStr}-${uniqueCode}`
  
  // Check for collision (extremely rare)
  const exists = await Company.findOne({ companyId })
  if (exists) {
    return generateCompanyId(companyName)  // Regenerate
  }
  
  return companyId
}
```

### Job ID Generation
```javascript
async function generateJobId(companyId) {
  const datePart = companyId.split('-')[1]  // Extract date
  const uniqueCode = generateId()
  const jobId = `JOB-${datePart}-${uniqueCode}`
  
  // Check for collision (extremely rare)
  const exists = await Job.findOne({ jobId })
  if (exists) {
    return generateJobId(companyId)  // Regenerate
  }
  
  return jobId
}
```

## Collision Probability

With nanoid using 36 characters (0-9, A-Z) and length 10:

- **Total possible IDs**: 36^10 = 3.65 × 10^15 (3.65 quadrillion)
- **Collision probability**: ~1% after generating 1 billion IDs
- **In practice**: With date prefix, collision is virtually impossible

## Benefits

1. **Human-Readable**: Easy to identify type (COMP vs JOB) and creation date
2. **Sortable**: Date prefix allows chronological sorting
3. **Traceable**: Can link jobs to companies via Company ID
4. **Secure**: Cryptographically strong random generation
5. **Scalable**: Can handle millions of companies and jobs
6. **URL-Safe**: Can be used in URLs without encoding

## Alternative Libraries

### UUID (Alternative Option)
```bash
npm install uuid
```

```javascript
import { v4 as uuidv4 } from 'uuid'

// Generate UUID
const companyId = `COMP-${uuidv4()}`
// Example: COMP-550e8400-e29b-41d4-a716-446655440000
```

**Pros**: Industry standard, guaranteed uniqueness
**Cons**: Longer (36 chars), harder to read, slower

### ULID (Alternative Option)
```bash
npm install ulid
```

```javascript
import { ulid } from 'ulid'

// Generate ULID
const companyId = `COMP-${ulid()}`
// Example: COMP-01ARZ3NDEKTSV4RRFFQ69G5FAV
```

**Pros**: Sortable, timestamp-based, URL-safe
**Cons**: Less customizable than nanoid

## Recommendation

✅ **Use nanoid** for this project because:
- Perfect balance of size, speed, and security
- Customizable alphabet (uppercase only)
- Smaller IDs than UUID
- Better performance
- URL-friendly by default

## Testing

```javascript
// Test Company ID generation
const companyId = await generateCompanyId("Tech Corp")
console.log(companyId)  // COMP-20250109-A1B2C3D4E5

// Test Job ID generation
const jobId = await generateJobId(companyId)
console.log(jobId)  // JOB-20250109-K9L8M7N6O5

// Verify uniqueness
const isDuplicate = await Job.findOne({ jobId })
console.log(isDuplicate)  // null (no duplicate)
```

## Summary

- **Library**: `nanoid` (recommended)
- **Company ID Format**: `COMP-YYYYMMDD-XXXXXXXXXX`
- **Job ID Format**: `JOB-YYYYMMDD-XXXXXXXXXX`
- **Collision Probability**: Virtually zero
- **Performance**: Fast and efficient
- **Security**: Cryptographically strong

